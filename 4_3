#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int *table(char *word) {
    int lengthw = strlen(word);
    int *mass= (int*) malloc(lengthw*sizeof(int));

    for(int i=1; i<lengthw; i++){
        mass[lengthw-i-1]=i;
        for(int j=lengthw-i; j<lengthw-1; j++){
            if(word[lengthw-i-1]==word[j] && i!=1) mass[lengthw-i-1]=mass[lengthw-i];
        }
    }

    for(int i=0; i<lengthw-1; i++){
        if(word[i]==word[lengthw-1]){
            mass[lengthw-1]=mass[i];
            break;
        }
        else mass[lengthw-1]=1 + mass[0];
    }
    return mass;
}

char *copy(char *sentense, int j){
    int count=0;
    for(int i=j; (sentense[i]!=44)&&(sentense[i]!=46)&&(sentense[i]!=32); i++){
        count++;
    }
    char *word = (char*) malloc(count*sizeof(char));
    for(int i=j, k=0; k<count; k++, i++){
        word[k]=sentense[i];
    }


    int lengthw =strlen(word);
    for(int i=0; i<lengthw; i++){
        printf("%c", word[i]);
    }
    printf("\n");
}

int checkup(char *sentense, int *tablew, char *word){

    int count=0;
    int lengthw = strlen(word);

    for(int i=lengthw-1; i>=0; ){

        for(int j=1; j<lengthw; j--){
            if(sentense[i-j+1]!=word[lengthw-j]){
                int t=0;
                for(int k=0; k<lengthw; k++){
                    if(sentense[i-j+1]==word[k]){
                        t = tablew[k];
                        break;
                    }
                    else t=0;
                }
                if(t) {
                    i = i - t;
                    break;
                }
                else i = i-lengthw-1;
                break;
            }
            else if((lengthw-j-1)==0){
                count++;
                i = i - lengthw-1;
                break;
            }
        }
    }
    return count;

}

int main(){

    char sentense[]="slowo teka";
    int lengths = strlen(sentense);
    for(int i=0; i<lengths; i++){
        if((sentense[i]==44)||(sentense[i]==32)){
            continue;
        }
        else if(sentense[i]==46){
            break;
        }
        else if((sentense[i]<123)&&(sentense[i]>96)){
            char *word =copy(sentense, i);
            int lenghtw =strlen(word);
            int *tablew = table(word);
            int num = checkup(sentense, tablew, word);
            if(num == 0) {
                for(int j=0; j<lenghtw; j++) printf("%c", word[j]);
                printf("\n");
            }
        }
    }
}
